<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Scanner</title>

<script src="https://docs.opencv.org/4.x/opencv.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body { margin:0; background:#111; color:#fff; font-family:sans-serif; }
video { width:100%; height:60vh; object-fit:cover; }
#preview img { width:70px; margin:4px; border:2px solid #0f0; }
button { margin:6px; padding:10px; font-size:16px; }
textarea { width:100%; height:120px; }
</style>
</head>

<body>

<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<div>
<button onclick="capture()">Capture</button>
<button onclick="savePDF()">PDF</button>
<button onclick="ocr()">OCR</button>
</div>

<div id="preview"></div>
<textarea id="text"></textarea>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const { jsPDF } = window.jspdf;

let pages = [];

navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment"} })
.then(stream => video.srcObject = stream);

function capture(){
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  ctx.drawImage(video,0,0);

  const img = canvas.toDataURL("image/jpeg",0.8);
  pages.push(img);

  const thumb = document.createElement("img");
  thumb.src = img;
  document.getElementById("preview").appendChild(thumb);
}

async function ocr(){
  let resultText="";
  for(let img of pages){
    const res = await Tesseract.recognize(img,"eng");
    resultText += res.data.text + "\n";
  }
  document.getElementById("text").value=resultText;
}

async function savePDF(){
  const pdf = new jsPDF();
  pages.forEach((img,i)=>{
    if(i>0) pdf.addPage();
    pdf.addImage(img,"JPEG",0,0,210,297);
  });
  pdf.save("scan.pdf");
}
</script>

</body>
</html>
